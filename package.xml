<project name="package-glean" default="package" basedir=".">
    <description>Create a distribution of Glean</description>
    
    <property name="version"       value="1.0b"/>
    <property name="min.dist.name" value="glean-${version}"/>
    <property name="basic.dist.name" value="${min.dist.name}-with-tools"/>
    <property name="dist.dir"      value="dist"/>
    <property name="doc.dir"       value="doc"/>
    <property name="log.dir"       value="logs"/>
    <property name="scratch.dir"   value="glean"/>
    <property name="dist.docs"     value="target"/>
    <property name="glean.dir"     value="${basedir}"/>

    <property file="toolhome.properties"/>
    
    <basename property="package.script"   file="${ant.file}"/>

    <patternset id="dist.script.excludes">
        <exclude name="${ant.file}"/>
        <exclude name="${dist.dir}/"/>
        <exclude name="${doc.dir}/"/>
        <exclude name="${log.dir}/"/>
        <exclude name="${scratch.dir}/"/>
        <exclude name="${package.script}"/>
        <exclude name="*.txt"/>
        <exclude name="**/*.log"/>
        <exclude name="**/*.properties.local"/>                
    </patternset>
    
    <patternset id="doc.files">
        <include name="**/*.html"/>
        <include name="**/*.css"/>
    </patternset>

    <basename property="java2html.dir" file="${java2html.home}"/>
    <basename property="javancss.dir"  file="${javancss.home}"/>
    <basename property="jdepend.dir"   file="${jdepend.home}"/>
    <basename property="pmd.dir"       file="${pmd.home}"/>
    
    <patternset id="basic.tool.files">
        <include name="${java2html.dir}/**"/>
        <include name="${javancss.dir}/**"/>
        <include name="${jdepend.dir}/**"/>
        <include name="${pmd.dir}/**"/>
    </patternset>
    
    <target name="doc" 
	    description="Build the tool documentation">
        <ant dir="${doc.dir}" target="docs">
            <property name="docs.dest" value="${dist.docs}"/>
        </ant>
    </target>
    
    <target name="package" depends="package-min, package-basic"/>
    
    <target name="package-min"
        depends="doc"
    	description="Package up a minimum distribution of the scripts">
        <mkdir dir="${dist.dir}"/>
        
        <zip destfile="${dist.dir}/${min.dist.name}.zip">
            <zipfileset dir="${doc.dir}/${dist.docs}" prefix="${min.dist.name}/docs">
                <patternset refid="doc.files"/>
            </zipfileset>
            <zipfileset dir="${glean.dir}" prefix="${min.dist.name}">
                <patternset refid="dist.script.excludes"/>
            </zipfileset>
        </zip>
    </target>
    
    <target name="package-basic"
        depends="doc"
    	description="Package up a distribution of the scripts and basic tools">
        <mkdir dir="${dist.dir}"/>
        
        <zip destfile="${dist.dir}/${basic.dist.name}.zip">
            <zipfileset dir="${tools.base}" prefix="${basic.dist.name}/tools">
                <patternset refid="basic.tool.files"/>
            </zipfileset>
            <zipfileset dir="${doc.dir}/${dist.docs}" prefix="${basic.dist.name}/docs">
                <patternset refid="doc.files"/>
            </zipfileset>
            <zipfileset dir="${glean.dir}" prefix="${basic.dist.name}">
                <patternset refid="dist.script.excludes"/>
            </zipfileset>
        </zip>
    </target>
    
    <target name="release"
        depends="package"
    	description="Copy a distribution out to the server">
        
    </target>
    
    <target name="publish-docs" 
        depends="doc"
    	description="Publish the documentation pages to the server">
        
    </target>
    
    <target name="clean"
        depends="clean-docs"
        description="Delete generated files">
        <delete dir="${dist.dir}"/>
    </target>
    
    <target name="clean-docs">
        <ant dir="${doc.dir}" target="clean"/>
    </target>
    
</project>
