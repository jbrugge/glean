<?xml version="1.0"?>
<project name="get-glean-tools" default="all" basedir="."
    xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    Downloads as many of the tools that Glean uses as are available
    from public Maven repositories.
    </description>
    
    <!-- This is where each tool will get a subdirectory -->
    <property name="tools.base"      value="${user.home}/temp/tools"/>
    
    <!-- Repositories holding the tools -->
    <artifact:remoteRepository 
        id="repo1.repository" 
        url="http://repo1.maven.org/maven2" />
    <artifact:remoteRepository 
        id="statsvn.repository" 
        url="http://objectlabkit.sf.net/m1-repo"
        layout="legacy" />
    
    <!-- Simple macrodef for downloading a tool -->
    <macrodef name="fetch">
      <attribute name="group" />
      <attribute name="artifact" default="@{group}"/>
      <attribute name="version" />
      <attribute name="toolname" default="@{group}"/>
      <attribute name="repo" default="repo1.repository"/>
      <sequential>
        <!-- Download the tool and its dependencies to our local M2 repo -->
        <artifact:dependencies pathID="@{artifact}.path">
          <dependency groupID="@{group}"
            artifactID="@{artifact}"
            version="@{version}"/>
          <remoteRepository refid="@{repo}" />
        </artifact:dependencies>
        <!-- Copy the tool and its dependencies to a central place for Glean to use -->
        <copy todir="${tools.base}/@{artifact}-@{version}">
          <path refId="@{artifact}.path"/>
          <flattenmapper/>
        </copy>
      </sequential>
    </macrodef>
  
  <target name="beandoc">
    <fetch group="org.springframework" artifact="spring-beandoc" version="0.7.1"
        toolname="breandoc"/>
  </target>
  
  <target name="checkstyle">
    <fetch group="checkstyle" artifact="checkstyle" version="4.3"/>
  </target>
  
  <target name="cobertura">
    <fetch group="cobertura" artifact="cobertura" version="1.8"/>
  </target>
  
  <target name="emma">
    <fetch group="emma" artifact="emma" version="2.0.5312"/>
  </target>
  
  <target name="findbugs">
    <fetch group="findbugs" artifact="findbugs" version="1.0.0"/>
  </target>
  
  <target name="java2html14">
    <fetch group="java2html" artifact="j2h" version="1.3.1"
        toolname="java2html14"/>
  </target>
  
  <target name="java2html15">
    <fetch group="de.java2html" artifact="java2html" version="5.0"
        toolname="java2html15"/>
  </target>
  
  <target name="javancss">
    <fetch group="javancss" artifact="javancss" version="28.49"/>
  </target>
  
  <target name="jdepend">
    <fetch group="jdepend" artifact="jdepend" version="2.9.1"/>
  </target>
  
  <target name="pmd">
    <fetch group="pmd" artifact="pmd" version="3.9"/>
  </target>
  
  <target name="qalab">
    <fetch group="net.objectlab" artifact="qalab" version="1.0"
        toolname="qalab"/>
  </target>
  
  <target name="statcvs">
    <fetch group="statcvs" artifact="statcvs" version="0.1.3"/>
  </target>
  
  <target name="statsvn">
    <fetch group="net.sf.statsvn" artifact="statsvn" version="0.3.1"
        toolname="statsvn"
        repo="statsvn.repository"/>
  </target>
  
  <target name="all"
    depends="beandoc,checkstyle,cobertura,emma,findbugs,java2html14,java2html15,javancss,jdepend,pmd,qalab,statcvs,statsvn">
  </target>
</project>
